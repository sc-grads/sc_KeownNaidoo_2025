name: Notify Teams on PR Merge

on:
  pull_request:
    types: [closed]

jobs:
  notify-teams:
    if: github.event.pull_request.merged == true  # Ensures it only runs if PR is merged
    runs-on: ubuntu-latest
    steps:
      - name: Send Notification to Teams
        uses: neonidian/teams-notify-build-status@v3
        with:
          webhookUrl: ${{ secrets.WEBHOOK_URL }}
          title: "Pull Request Merged ğŸ‰"
          titleBackgroundColor: "blue"
          message: |
            **Keown Naidoo - A pull request has been merged! ğŸš€**
            - ğŸ· **Title:** ${{ github.event.pull_request.title }}
            - ğŸ“ **Description:** ${{ github.event.pull_request.body || 'No description provided' }}
            - ğŸ‘¤ **Author:** ${{ github.event.pull_request.user.login }}
            - ğŸ”— [View PR](${{ github.event.pull_request.html_url }})
            - ğŸŒ¿ **Merged Branch:** ${{ github.event.pull_request.head.ref }}
            - ğŸ”„ **Merged Into:** ${{ github.event.pull_request.base.ref }}

        env:
          SHOULD_DISPLAY_ACTOR_LABEL: true
          SHOULD_DISPLAY_VIEW_RUN_BUTTON: true
          SHOULD_DISPLAY_VIEW_COMMIT_BUTTON: true
